#summary Advanced Tips
#labels Phase-Implementation

= Advanced Tips =

== Integrating with iAd ==

Integrating with the Apple's iAd requires knowledge of Objective-C and Apples Foundation Framework. For more information about iAd, please refer to the Apple's document. emo uses [http://developer.apple.com/library/ios/#documentation/userexperience/Reference/ADBannerView_Ref/Reference/Reference.html ADBannerView] and your !ApplicationDelegate. Here's some ideas.

  * First add *iAd.framework* and *!CoreGraphics.framework* to your Frameworks.
  * Add ADBannerView member to your applicatoin delegate. Also, your application delegate should implement ADBannerViewDelegate.
{{{
#import <UIKit/UIKit.h>
#import <iAd/iAd.h>

@class EmoViewController;

@interface SuperGameAppDelegate : NSObject <UIApplicationDelegate, ADBannerViewDelegate> {
    UIWindow *window;
    EmoViewController *viewController;
    ADBannerView *adBannerView;
}
// .. snip
}}}

  * In your application delegate, add your ad banner.
{{{
- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
{
    window = [[UIWindow alloc] initWithFrame:[[UIScreen mainScreen] bounds]];
	
    viewController = [[EmoViewController alloc] init];
    viewController.view = [[EmoView alloc] initWithFrame:[[UIScreen mainScreen] bounds]];
    [viewController awakeFromNib];
	
    [self.window addSubview:self.viewController.view];
    
    [window makeKeyAndVisible];

    [self.viewController onLoad];

   /* 
     iAd banner should be added after viewController.onLoad
     because the view controller returns the current orientation option from main.nut.
    */
    adBannerView = [[ADBannerView alloc] initWithFrame:CGRectZero];

    NSInteger orientation = [self.viewController getOrientationOption];
    if (orientation == OPT_ORIENTATION_PORTRAIT) {
        adBannerView.currentContentSizeIdentifier = ADBannerContentSizeIdentifierPortrait;
    } else if (orientation == OPT_ORIENTATION_LANDSCAPE      ||
               orientation == OPT_ORIENTATION_LANDSCAPE_LEFT ||
               orientation == OPT_ORIENTATION_LANDSCAPE_RIGHT) {
        adBannerView.currentContentSizeIdentifier = ADBannerContentSizeIdentifierLandscape;
    }

    [self.viewController.view addSubview:adBannerView];
	
    adBannerView.delegate = self;
	
    adBannerView.requiredContentSizeIdentifiers = [NSSet setWithObjects: 
        ADBannerContentSizeIdentifierPortrait,
        ADBannerContentSizeIdentifierLandscape,
        nil];

    return YES;
}

/*
 * Hide the banner when ad banner fails.
 */
- (void)bannerView:(ADBannerView *)banner didFailToReceiveAdWithError:(NSError *)error{
    CGRect rectForHide = self.viewController.view.frame;
    rectForHide.origin.y = self.viewController.view.frame.size.height;
    adBannerView.frame = rectForHide;
}

- (void)dealloc
{
...snip
    adBannerView.delegate = nil;
    [adBannerView release];
...snip
    [super dealloc];
}

}}}

  * To tell iAd about the orientation, current orientation should be set in your main.nut.
{{{
/*
 * Called when this class is loaded
 */
function onLoad() {
    print("onLoad"); 

    // emo.Runtime.setOptions(OPT_ORIENTATION_LANDSCAPE_RIGHT);
    emo.Runtime.setOptions(OPT_ORIENTATION_PORTRAIT);

...snip
}
}}}